@model QL_HDPHONGLAB.Models.RegisterViewModel
@{
    ViewBag.Title = "DangKyPhong";
    Layout = "~/Views/Shared/_LayoutSite.cshtml";
}

<h2>Đăng Ký Mượn Phòng</h2>
<script src="~/Scripts/jquery-1.12.4.min.js"></script>
<script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
<link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap/bootstrap.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        DateTimePicker();
        $("#btnSave").click(function () {
            if (!$("#formCustomerBooking").valid()) {
                return;
            }
            AddCustomerBooking();
        });
        LoadBookingHistory();
    });


    function DateTimePicker() {
        $('.datepicker').datepicker({
            dateFormat: 'dd-M-yy',
            changeMonth: true,
            changeYear: true,
            showOn: 'button',
            sideBySide: true,
            controlType: 'select',
            buttonText: '<span class="glyphicon glyphicon-calendar"></span>',
            minDate: new Date()

        });

        $("#txtNgayDK").change(function () {
            var date2 = $("#txtNgayDK").datepicker('getDate', '+1d');
            date2.setDate(date2.getDate() + 1);
            $("#txtNgayTra").datepicker('option', 'minDate', date2);
            $("#txtNgayTra").datepicker('setDate', date2);

        });
    }


    function LoadBookingHistory() {
        $.ajax({
            async: true,
            type: 'GET',
            dataType: 'HTML',
            contentType: false,
            processType: false,
            url: '/DangKyPhongLab/LichSuDKPhong',
            success: function (data) {
                $("#divBookingHistory").html(data);
            },
            error: function () {
                alert('Có lỗi trong quá trình xử lý. Mời thử lại');
            }
        });
    }

    function ResetBooking() {
        $("#txtHoTen").val('');
        $("#txtDiaChi").val('');
        $("#txtSDT").val('');
        $("#ddPhongChiDinh").val(1);
        $("#txtSoLuong").val('');
        $("#txtHoTen").focus();
    }

    function AddCustomerBooking() {
        var objDkyPhong = {};
        objDkyPhong.HOTEN_GV = $("#txtHoTen").val();
        objDkyPhong.DIACHI_GV = $("#txtDiaChi").val();
        objDkyPhong.SDT_GV = $("#txtSDT").val();
        objDkyPhong.NGAY_DKPH = $("#txtNgayDK").val();
        objDkyPhong.NGAYTRAPH = $("#txtNgayTra").val();

        objDkyPhong.PHONGCHIDINH = $("#ddPhongChiDinh").val();
        objDkyPhong.SOLUONG = $("#txtSoLuong").val();

        $.ajax({
            async: true,
            type: 'POST',
            dataType: 'JSON',
            contentType: 'application/json; charset=utf-8',
            url: '/DangKyPhongLab/DangKyPhong',
            data: JSON.stringify(objDkyPhong),
            success: function (data) {
                if (data.success === true) {
                    alert(data.message);
                    ResetBooking();
                    LoadBookingHistory();
                }
            },
            error: function () {
                alert('Có lỗi trong quá trình xử lý');
            }
        })
    }



</script>
<span class="glyphicon glyphicon-calendar"></span>

<div style="margin-top: 50px">
    <button type="button" class="btn btn-primary" data-toggle="modal"
            data-target="#divNewBooking" data-backdrop="static"
            data-keyboard="false">
        Đăng Ký Phòng
    </button>
</div>

<div id="divNewBooking" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Đăng Ký Phòng</h4>
            </div>
            <div class="modal-body">
                <form id="formCustomerBooking">
                    <div class="container">
                        <div class="row ">
                            <div class="form-group ">
                                @Html.LabelFor(model => model.HOTEN_GV, new { @class = "control-label" })
                                @Html.TextBoxFor(model => model.HOTEN_GV, new { @class = "form-control", @id = "txtHoTen" })
                                @Html.ValidationMessageFor(model => model.HOTEN_GV, null, new { @class = "text-danger", @id = "txtHoTen" })
                            </div>
                            <div class="form-group ">
                                @Html.LabelFor(model => model.DIACHI_GV, new { @class = "control-label" })
                                @Html.TextBoxFor(model => model.DIACHI_GV, new { @class = "form-control", @id = "txtDiaChi" })
                                @Html.ValidationMessageFor(model => model.DIACHI_GV, null, new { @class = "text-danger" })
                            </div>
                        </div>


                        <div class="row ">
                            <div class="form-group ">
                                @Html.LabelFor(model => model.SDT_GV, new { @class = "control-label" })
                                @Html.TextBoxFor(model => model.SDT_GV, new { @class = "form-control", @id = "txtSDT" })
                                @Html.ValidationMessageFor(model => model.SDT_GV, null, new { @class = "text-danger" })
                            </div>
                            <div class="form-group ">
                                @Html.LabelFor(model => model.NGAY_DKPH, new { @class = "control-label" })
                                @Html.EditorFor(model => model.NGAY_DKPH, new { htmlAttributes = new { @readonly = "true", Value = Model.NGAY_DKPH.ToString("dd-MMM-yyyy"), @class = "form-control datepicker", @id = "txtNgayDK" } })
                                @Html.ValidationMessageFor(model => model.NGAY_DKPH, null, new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group ">
                                @Html.LabelFor(model => model.NGAY_TRAPH, new { @class = "control-label" })
                                @Html.EditorFor(model => model.NGAY_TRAPH,
                               new
                                    {
                                        htmlAttributes = new
                                        {
                                            @readonly = "true",
                                            Value = Model.NGAY_TRAPH.ToString("dd-MMM-yyyy"),
                                   @class = "form-control datepicker",
                                            @id = "txtNgayTra"
                                        }
                                    })
                                @Html.ValidationMessageFor(model => model.NGAY_TRAPH, null, new { @class = "text-danger" })
                            </div>
                            <div class="form-group ">
                                @Html.LabelFor(model => model.PHONGCHIDINH, new { @class = "control-label" })
                                @Html.DropDownListFor(model => model.PHONGCHIDINH, Model.DSPhongLAB,
                               new { @class = "form-control", @id = "ddPhongChiDinh" })
                                @Html.ValidationMessageFor(model => model.PHONGCHIDINH, null, new { @class = "text-danger" })
                            </div>
                        </div>


                        <div class="row">
                            <div class="form-group ">
                                @Html.LabelFor(model => model.SOLUONG, new { @class = "control-label" })
                                @Html.TextBoxFor(model => model.SOLUONG, new { @class = "form-control", @id = "txtSoLuong" })
                                @Html.ValidationMessageFor(model => model.SOLUONG, null, new { @class = "text-danger" })
                            </div>
                            <div class="form-group ">

                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="btnSave" type="button" class="btn btn-success">Lưu</button>&nbsp;
                <button type="button" data-dismiss="modal" class="btn btn-danger">Đóng</button>
            </div>
        </div>
    </div>
</div>

<div style="margin-top: 10px"></div>
<div id="divNewBooking">

</div>
<div id="divBookingHistory"></div>
